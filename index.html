<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Учебный Dashboard</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/main.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/main.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.8/main.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/list@6.1.8/main.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --tg-bg-color: var(--tg-theme-bg-color, #f8f9fa);
            --tg-text-color: var(--tg-theme-text-color, #212529);
            --tg-hint-color: var(--tg-theme-hint-color, #6c757d);
            --tg-link-color: var(--tg-theme-link-color, #0d6efd);
            --tg-button-color: var(--tg-theme-button-color, #0d6efd);
            --tg-button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary-bg-color: var(--tg-theme-secondary-bg-color, #e9ecef);
            --tg-card-bg: var(--tg-theme-secondary-bg-color, #ffffff);
            --tg-border-radius: 12px;
            --tg-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--tg-bg-color);
            color: var(--tg-text-color);
            min-height: 100vh;
        }
        
        .dashboard-container {
            padding: 16px;
            max-width: 100%;
        }
        
        .header {
            margin-bottom: 24px;
            text-align: center;
        }
        
        .header h4 {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--tg-text-color);
        }
        
        .header p {
            color: var(--tg-hint-color);
            font-size: 0.9em;
            margin: 0;
        }
        
        .stats-card {
            background-color: var(--tg-card-bg);
            border-radius: var(--tg-border-radius);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--tg-shadow);
            border: none;
        }
        
        .stats-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--tg-button-color);
        }
        
        .stats-label {
            font-size: 0.85rem;
            color: var(--tg-hint-color);
        }
        
        .nav-tabs {
            border-bottom: none;
            margin-bottom: 16px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: var(--tg-hint-color);
            font-weight: 500;
            padding: 10px 16px;
            border-radius: var(--tg-border-radius);
        }
        
        .nav-tabs .nav-link.active {
            color: var(--tg-button-color);
            background-color: rgba(13, 110, 253, 0.1);
        }
        
        .calendar-container {
            background-color: var(--tg-card-bg);
            border-radius: var(--tg-border-radius);
            padding: 16px;
            box-shadow: var(--tg-shadow);
            margin-bottom: 16px;
        }
        
        .fc {
            --fc-border-color: var(--tg-secondary-bg-color);
            --fc-page-bg-color: var(--tg-card-bg);
            --fc-neutral-bg-color: var(--tg-secondary-bg-color);
            --fc-list-event-hover-bg-color: var(--tg-secondary-bg-color);
            --fc-today-bg-color: rgba(13, 110, 253, 0.1);
        }
        
        .fc .fc-toolbar-title {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .fc .fc-col-header-cell {
            background-color: var(--tg-card-bg);
            padding: 8px 0;
        }
        
        .fc .fc-col-header-cell-cushion {
            color: var(--tg-text-color);
            font-weight: 500;
            text-decoration: none;
            font-size: 0.85rem;
        }
        
        .fc .fc-daygrid-day-number {
            color: var(--tg-text-color);
            padding: 4px;
            font-size: 0.9rem;
        }
        
        .fc-event {
            cursor: pointer;
            font-size: 0.75rem;
            padding: 2px 4px;
            margin: 1px 0;
            border-radius: 6px;
            border: none;
            font-weight: 500;
        }
        
        .fc-event .fc-event-main {
            padding: 2px;
        }
        
        .event-lecture {
            background-color: rgba(75, 192, 192, 0.15);
            color: #4bc0c0;
        }
        
        .event-practice {
            background-color: rgba(54, 162, 235, 0.15);
            color: #36a2eb;
        }
        
        .event-lab {
            background-color: rgba(255, 159, 64, 0.15);
            color: #ff9f40;
        }
        
        .event-exam {
            background-color: rgba(255, 99, 132, 0.15);
            color: #ff6384;
        }
        
        .event-test {
            background-color: rgba(153, 102, 255, 0.15);
            color: #9966ff;
        }
        
        .event-other {
            background-color: rgba(201, 203, 207, 0.15);
            color: #c9cbcf;
        }
        
        .floating-action-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--tg-button-color);
            color: var(--tg-button-text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            border: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--tg-button-color);
            color: var(--tg-button-text-color);
            padding: 12px 24px;
            border-radius: var(--tg-border-radius);
            box-shadow: var(--tg-shadow);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 80%;
            text-align: center;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .modal-content {
            background-color: var(--tg-card-bg);
            color: var(--tg-text-color);
            border-radius: var(--tg-border-radius);
            border: none;
            box-shadow: var(--tg-shadow);
        }
        
        .form-control, .form-select {
            background-color: var(--tg-secondary-bg-color);
            color: var(--tg-text-color);
            border: none;
            border-radius: var(--tg-border-radius);
            padding: 10px 14px;
        }
        
        .btn-primary {
            background-color: var(--tg-button-color);
            border-color: var(--tg-button-color);
            color: var(--tg-button-text-color);
            border-radius: var(--tg-border-radius);
        }
        
        .btn-outline-primary {
            border-color: var(--tg-button-color);
            color: var(--tg-button-color);
            background-color: transparent;
            border-radius: var(--tg-border-radius);
        }
        
        .badge {
            font-weight: 500;
            padding: 6px 10px;
            border-radius: var(--tg-border-radius);
        }
        
        .event-list-item {
            padding: 12px;
            border-bottom: 1px solid var(--tg-secondary-bg-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .event-list-item:last-child {
            border-bottom: none;
        }
        
        .event-list-date {
            font-weight: 600;
            color: var(--tg-button-color);
            min-width: 80px;
        }
        
        .event-list-details {
            flex-grow: 1;
            padding: 0 12px;
        }
        
        .event-list-title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .event-list-meta {
            font-size: 0.85rem;
            color: var(--tg-hint-color);
        }
        
        @media (max-width: 576px) {
            .dashboard-container {
                padding: 12px;
            }
            
            .stats-card {
                padding: 12px;
            }
            
            .stats-value {
                font-size: 1.5rem;
            }
            
            .event-list-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .event-list-date {
                margin-bottom: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h4><i class="fas fa-calendar-alt me-2"></i>Учебный Dashboard</h4>
            <p>Ваше расписание всегда под рукой</p>
        </div>
        
        <div class="row">
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-value" id="events-count">0</div>
                    <div class="stats-label">Предстоящих занятий</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-value" id="groups-count">0</div>
                    <div class="stats-label">Ваших групп</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-value" id="exams-count">0</div>
                    <div class="stats-label">Ближайших экзаменов</div>
                </div>
            </div>
        </div>
        
        <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar-tab-pane" type="button" role="tab">
                    <i class="fas fa-calendar-day me-1"></i> Календарь
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="list-tab" data-bs-toggle="tab" data-bs-target="#list-tab-pane" type="button" role="tab">
                    <i class="fas fa-list-ul me-1"></i> Список
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="dashboardTabContent">
            <div class="tab-pane fade show active" id="calendar-tab-pane" role="tabpanel">
                <div class="calendar-container">
                    <div id="calendar"></div>
                </div>
            </div>
            <div class="tab-pane fade" id="list-tab-pane" role="tabpanel">
                <div class="calendar-container">
                    <div id="event-list"></div>
                </div>
            </div>
        </div>
        
        <button class="floating-action-btn" id="add-event-btn">
            <i class="fas fa-plus"></i>
        </button>
        
        <div class="notification" id="notification"></div>
    </div>

    <!-- Модальное окно для добавления/редактирования события -->
    <div class="modal fade" id="eventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle"><i class="fas fa-calendar-plus me-2"></i>Добавить занятие</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm">
                        <input type="hidden" id="eventId">
                        <div class="mb-3">
                            <label for="eventTitle" class="form-label">Название предмета</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="eventType" class="form-label">Тип занятия</label>
                            <select class="form-select" id="eventType">
                                <option value="lecture">Лекция</option>
                                <option value="practice">Практика</option>
                                <option value="lab">Лабораторная</option>
                                <option value="exam">Экзамен</option>
                                <option value="test">Зачёт</option>
                                <option value="other">Другое</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="eventStart" class="form-label">Начало</label>
                                <input type="datetime-local" class="form-control" id="eventStart" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="eventEnd" class="form-label">Конец</label>
                                <input type="datetime-local" class="form-control" id="eventEnd" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="eventLocation" class="form-label"><i class="fas fa-map-marker-alt me-1"></i>Аудитория</label>
                            <input type="text" class="form-control" id="eventLocation" placeholder="305">
                        </div>
                        <div class="mb-3">
                            <label for="eventTeacher" class="form-label"><i class="fas fa-chalkboard-teacher me-1"></i>Преподаватель</label>
                            <input type="text" class="form-control" id="eventTeacher" placeholder="Иванов И.И.">
                        </div>
                        <div class="mb-3">
                            <label for="eventDescription" class="form-label"><i class="fas fa-align-left me-1"></i>Примечание</label>
                            <textarea class="form-control" id="eventDescription" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger me-auto" id="deleteEventBtn" style="display: none;">
                        <i class="fas fa-trash me-1"></i> Удалить
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> Отмена
                    </button>
                    <button type="button" class="btn btn-primary" id="saveEventBtn">
                        <i class="fas fa-save me-1"></i> Сохранить
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@6.1.8/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/list@6.1.8/index.global.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация Telegram WebApp
            const tg = window.Telegram.WebApp;
            tg.expand();
            tg.enableClosingConfirmation();
            
            // Получаем данные пользователя
            const user = tg.initDataUnsafe.user || {};
            const userId = user.id;
            const userName = [user.first_name, user.last_name].filter(Boolean).join(' ');
            
            // Функция для показа уведомлений
            function showNotification(message, duration = 3000) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                           notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }
        
        // Инициализация календаря
        const calendarEl = document.getElementById('calendar');
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: false,
            locale: 'ru',
            firstDay: 1,
            height: 'auto',
            editable: true,
            selectable: true,
            eventClick: function(info) {
                openEditModal(info.event);
            },
            dateClick: function(info) {
                openAddModal(info.date);
            },
            events: loadEvents(),
            eventContent: function(arg) {
                const typeIcon = getTypeIcon(arg.event.extendedProps.type);
                const timeText = arg.timeText ? `${arg.timeText} ` : '';
                
                return {
                    html: `
                        <div class="d-flex flex-column" style="gap: 2px;">
                            <div class="d-flex align-items-center">
                                <span class="me-1">${typeIcon}</span>
                                <div class="fw-bold">${arg.event.title}</div>
                            </div>
                            ${timeText ? `<div class="small">${timeText}</div>` : ''}
                            ${arg.event.extendedProps.location ? `<div class="small"><i class="fas fa-map-marker-alt"></i> ${arg.event.extendedProps.location}</div>` : ''}
                        </div>
                    `
                };
            },
            eventClassNames: function(arg) {
                return `event-${arg.event.extendedProps.type || 'other'}`;
            },
            datesSet: function(info) {
                updateCurrentDate(info.view);
                updateStats();
                renderEventList();
            }
        });
        
        calendar.render();
        
        // Загрузка данных
        function loadEvents() {
            const savedEvents = localStorage.getItem('studentCalendarEvents');
            return savedEvents ? JSON.parse(savedEvents) : [];
        }
        
        function saveEvents(events) {
            localStorage.setItem('studentCalendarEvents', JSON.stringify(events));
        }
        
        // Обновление статистики
        function updateStats() {
            const events = loadEvents();
            const now = new Date();
            const upcomingEvents = events.filter(e => new Date(e.start) > now);
            const exams = events.filter(e => e.extendedProps.type === 'exam' && new Date(e.start) > now);
            
            document.getElementById('events-count').textContent = upcomingEvents.length;
            document.getElementById('exams-count').textContent = exams.length;
        }
        
        // Рендер списка событий
        function renderEventList() {
            const events = loadEvents();
            const now = new Date();
            const upcomingEvents = events
                .filter(e => new Date(e.start) > now)
                .sort((a, b) => new Date(a.start) - new Date(b.start));
            
            const eventListEl = document.getElementById('event-list');
            eventListEl.innerHTML = '';
            
            if (upcomingEvents.length === 0) {
                eventListEl.innerHTML = `
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-calendar-plus fa-2x mb-3"></i>
                        <p>Нет предстоящих занятий</p>
                    </div>
                `;
                return;
            }
            
            upcomingEvents.forEach(event => {
                const eventEl = document.createElement('div');
                eventEl.className = 'event-list-item';
                
                const startDate = new Date(event.start);
                const options = { 
                    weekday: 'short', 
                    day: 'numeric', 
                    month: 'short',
                    hour: '2-digit', 
                    minute: '2-digit'
                };
                
                eventEl.innerHTML = `
                    <div class="event-list-date">
                        ${startDate.toLocaleDateString('ru-RU', options)}
                    </div>
                    <div class="event-list-details">
                        <div class="event-list-title">
                            <span class="me-2">${getTypeIcon(event.extendedProps.type)}</span>
                            ${event.title}
                        </div>
                        <div class="event-list-meta">
                            ${event.extendedProps.location ? `<span class="me-3"><i class="fas fa-map-marker-alt"></i> ${event.extendedProps.location}</span>` : ''}
                            ${event.extendedProps.teacher ? `<span><i class="fas fa-chalkboard-teacher"></i> ${event.extendedProps.teacher}</span>` : ''}
                        </div>
                    </div>
                    <button class="btn btn-sm btn-outline-primary edit-event-btn" data-id="${event.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                `;
                
                eventListEl.appendChild(eventEl);
            });
            
            // Обработчики для кнопок редактирования
            document.querySelectorAll('.edit-event-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const eventId = this.getAttribute('data-id');
                    const events = loadEvents();
                    const event = events.find(e => e.id === eventId);
                    if (event) {
                        openEditModal({
                            id: event.id,
                            title: event.title,
                            start: event.start,
                            end: event.end,
                            extendedProps: {
                                type: event.extendedProps.type,
                                location: event.extendedProps.location,
                                teacher: event.extendedProps.teacher,
                                description: event.extendedProps.description
                            }
                        });
                    }
                });
            });
        }
        
        // Иконки для типов занятий
        function getTypeIcon(type) {
            const icons = {
                'lecture': '<i class="fas fa-chalkboard-teacher"></i>',
                'practice': '<i class="fas fa-pen-fancy"></i>',
                'lab': '<i class="fas fa-flask"></i>',
                'exam': '<i class="fas fa-file-alt"></i>',
                'test': '<i class="fas fa-check-circle"></i>',
                'other': '<i class="fas fa-calendar-alt"></i>'
            };
            return icons[type] || '<i class="fas fa-calendar-alt"></i>';
        }
        
        // Модальные окна
        function openAddModal(date) {
            const modal = new bootstrap.Modal(document.getElementById('eventModal'));
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-calendar-plus me-2"></i>Добавить занятие';
            document.getElementById('eventId').value = '';
            document.getElementById('eventForm').reset();
            document.getElementById('deleteEventBtn').style.display = 'none';
            
            // Установка даты и времени по умолчанию
            const startDate = new Date(date);
            startDate.setHours(9, 0, 0, 0);
            
            const endDate = new Date(startDate);
            endDate.setHours(startDate.getHours() + 1);
            
            document.getElementById('eventStart').value = formatDateTimeForInput(startDate);
            document.getElementById('eventEnd').value = formatDateTimeForInput(endDate);
            
            modal.show();
        }
        
        function openEditModal(event) {
            const modal = new bootstrap.Modal(document.getElementById('eventModal'));
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-edit me-2"></i>Редактировать занятие';
            document.getElementById('eventId').value = event.id;
            document.getElementById('eventTitle').value = event.title;
            document.getElementById('eventType').value = event.extendedProps.type || 'lecture';
            document.getElementById('eventStart').value = formatDateTimeForInput(event.start);
            document.getElementById('eventEnd').value = formatDateTimeForInput(event.end || new Date(event.start.getTime() + 60 * 60 * 1000));
            document.getElementById('eventLocation').value = event.extendedProps.location || '';
            document.getElementById('eventTeacher').value = event.extendedProps.teacher || '';
            document.getElementById('eventDescription').value = event.extendedProps.description || '';
            document.getElementById('deleteEventBtn').style.display = 'block';
            
            modal.show();
        }
        
        function formatDateTimeForInput(date) {
            if (!(date instanceof Date)) {
                date = new Date(date);
            }
            const pad = num => num.toString().padStart(2, '0');
            return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
        }
        
        // Обработчики событий
        document.getElementById('add-event-btn').addEventListener('click', function() {
            openAddModal(calendar.getDate());
        });
        
        document.getElementById('saveEventBtn').addEventListener('click', function() {
            const eventId = document.getElementById('eventId').value;
            const eventTitle = document.getElementById('eventTitle').value.trim();
            const eventType = document.getElementById('eventType').value;
            const eventStart = document.getElementById('eventStart').value;
            const eventEnd = document.getElementById('eventEnd').value;
            const eventLocation = document.getElementById('eventLocation').value.trim();
            const eventTeacher = document.getElementById('eventTeacher').value.trim();
            const eventDescription = document.getElementById('eventDescription').value.trim();
            
            if (!eventTitle) {
                showNotification('Укажите название предмета');
                return;
            }
            
            const newEvent = {
                id: eventId || Date.now().toString(),
                title: eventTitle,
                start: eventStart,
                end: eventEnd,
                extendedProps: {
                    type: eventType,
                    location: eventLocation,
                    teacher: eventTeacher,
                    description: eventDescription
                }
            };
            
            let events = loadEvents();
            
            if (eventId) {
                // Редактирование существующего события
                events = events.map(e => e.id === eventId ? newEvent : e);
                showNotification('Занятие обновлено');
            } else {
                // Добавление нового события
                events.push(newEvent);
                showNotification('Занятие добавлено');
            }
            
            saveEvents(events);
            calendar.refetchEvents();
            updateStats();
            renderEventList();
            
            // Автоматическое закрытие модального окна через 1 секунду
            setTimeout(() => {
                bootstrap.Modal.getInstance(document.getElementById('eventModal')).hide();
            }, 1000);
        });
        
        document.getElementById('deleteEventBtn').addEventListener('click', function() {
            if (confirm('Вы уверены, что хотите удалить это занятие?')) {
                const eventId = document.getElementById('eventId').value;
                let events = loadEvents();
                events = events.filter(e => e.id !== eventId);
                
                saveEvents(events);
                calendar.refetchEvents();
                updateStats();
                renderEventList();
                
                bootstrap.Modal.getInstance(document.getElementById('eventModal')).hide();
                showNotification('Занятие удалено');
            }
        });
        
        // Инициализация при загрузке
        updateStats();
        renderEventList();
        
        // Показываем приветственное сообщение
        if (userName) {
            setTimeout(() => {
                showNotification(`Добро пожаловать, ${userName}!`);
            }, 1000);
        }

        // Применяем тему Telegram
        function applyTheme() {
            document.documentElement.style.setProperty('--tg-bg-color', tg.themeParams.bg_color || '#f8f9fa');
            document.documentElement.style.setProperty('--tg-text-color', tg.themeParams.text_color || '#212529');
            document.documentElement.style.setProperty('--tg-hint-color', tg.themeParams.hint_color || '#6c757d');
            document.documentElement.style.setProperty('--tg-link-color', tg.themeParams.link_color || '#0d6efd');
            document.documentElement.style.setProperty('--tg-button-color', tg.themeParams.button_color || '#0d6efd');
            document.documentElement.style.setProperty('--tg-button-text-color', tg.themeParams.button_text_color || '#ffffff');
            document.documentElement.style.setProperty('--tg-secondary-bg-color', tg.themeParams.secondary_bg_color || '#e9ecef');
            document.documentElement.style.setProperty('--tg-card-bg', tg.themeParams.secondary_bg_color || '#ffffff');
        }

        // Применяем тему при загрузке и при изменении
        applyTheme();
        tg.onEvent('themeChanged', applyTheme);
    });
</script>
</body> 
</html>
